<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <link rel="stylesheet" href="./../assets/css/styles.css">
    
</head>
<body>
    <div class="sidebar">
        <div class="profile">
            
            <h2>Naida Sma</h2>
            <p>Admin</p>
        </div>
        <ul class="nav-links">
            <li><a href="main_page.html">Dashboard</a></li>
            <li><a href="inventory_management.html">Inventory Management</a></li>
            <li><a href="categories.html">Categories</a></li>
            <li><a href="suppliers.html">Suppliers</a></li>
            <li><a href="invoice.html">Invoice</a></li>
            <li><a href="managing_accounts.html">Employers</a></li>
            <li><a href="barcode.html">Barcode scanning</a></li>
           
        </ul>
    </div>
        <div class="inventory-management">
            <header>
                <h1>Inventory Management</h1>
            </header>
            <div class="inventory-content">
                <div class="form-container">
                    <form id="inventoryForm">
                        <h2>Add New Item</h2>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="itemName">Item Name</label>
                                <input type="text" id="itemName" name="itemName" required>
                            </div>
        
                            
                        </div>
        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="unitPrice">Unit Price(BAM)</label>
                                <input type="number" id="unitPrice" name="unitPrice" step="0.01" required value="0.00" oninput="formatPrice(this)" required>
                            </div>
        
                            <div class="form-group">
                                <label for="quantity">Quantity</label>
                                <input type="number" id="quantity" name="quantity" min="1" value="1" required>
                            </div>
                        </div>
                           
        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="supplierID">Supplier</label>
                                <select id="supplierID" name="supplierID" >
                                    <option value="" disabled selected>Select Supplier</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
        
                            <div class="form-group">
                                <label for="categoryID">Category</label>
                                <select id="categoryID" name="categoryID" onchange="getCategories(this.value)" >
                                    <option value="" disabled selected>Select Category</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                        </div>
    
                        <div class="form-row">
                            <div class="form-group">
                                <label for="voltageRating">Voltage Rating</label>
                                <input type="text" id="voltageRating" name="voltageRating">
                            </div>
            
                            <div class="form-group">
                                <label for="amperageRating">Amperage Rating</label>
                                <input type="text" id="amperageRating" name="amperageRating">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="userID">User adding the item:</label>
                            <select id="userID" name="userID" onchange="getUsers(this.value)" >
                                <option value="" disabled selected>Name and surname</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                            </div>
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" required></textarea>
                        </div>
        
                        <div class="form-group">
                            <button type="submit">Add Item</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>        
        <div class="list-container">
            <h2>Inventory List</h2>
        <table id="inventoryTable">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Unit Price</th>
                    <th>Quantity</th>
                    <th>Supplier</th>
                    <th>Category</th>
                    <th>Voltage Rating</th>
                    <th>Amperage Rating</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Inventory items will be appended here dynamically -->
            </tbody>
        </table>
    </div>
    </div>
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/jquery.min.js"></script>

    <script >
function getSuppliers() {
    $.ajax({
        url: '../../rest/suppliers',
        method: 'GET',
        success: function(data) {
            let output = '<option value="" disabled selected>Select Supplier</option>';
            data.forEach(supplier => {
                output += `<option value="${supplier.supplierid}">${supplier.supplierName}</option>`;
            });
            $('#supplierID').html(output);
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log('Error loading suppliers:', errorThrown);
        }
    });
}

function getCategories() {
    $.ajax({
        url: '../../rest/categories',
        method: 'GET',
        success: function(data) {
            let output = '<option value="" disabled selected>Select Category</option>';
            data.forEach(category => {
                output += `<option value="${category.categoryid}">${category.categoryName}</option>`;
            });
            $('#categoryID').html(output);
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log('Error loading categories:', errorThrown);
        }
    });
}

$(document).ready(function() {
    getSuppliers();
    getCategories();
});

/*
function addItem() {
    var item = {};
    item.itemName = document.getElementById("itemName").value;
    item.unitPrice = document.getElementById("unitPrice").value;
    item.quantity = document.getElementById("quantity").value;
    item.supplierID = document.getElementById("supplierID").value;
    item.categoryid = document.getElementById("categoryID").value;
    item.voltageRating = document.getElementById("voltageRating").value;
    item.amperageRating = document.getElementById("amperageRating").value;
    item.description = document.getElementById("description").value;
    $.ajax({
        url: '../../rest/inventory/add',
        method: 'POST',
        data:item,
        dataType:"json",
        success: function(data) {
            console.log("success");
            getAllItems(); 
            document.getElementById('itemName').value = '';
            document.getElementById('unitPrice').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('supplierID').value = '';
            document.getElementById('categoryID').value = '';
            document.getElementById('voltageRating').value = '';
            document.getElementById('amperageRating').value = '';
            document.getElementById('description').value = '';
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log(jqXHR);
            console.log(textStatus);
            console.log(errorThrown);
            alert("There was an error adding the item. Please try again later.");
        }
    });
}
*/
$('#inventoryForm').submit(function(e) {
    e.preventDefault(); 

let formData = {
    itemName: $('#itemName').val(),
    unitPrice: $('#unitPrice').val(),
    quantity: $('#quantity').val(),
    supplierID: $('#supplierID').val(),
    categoryID: $('#categoryID').val(),
    voltageRating: $('#voltageRating').val(),
    amperageRating: $('#amperageRating').val(),
    description: $('#description').val(),
};

$.ajax({
    url: '../../rest/inventory/add', 
    method: 'POST',
    data: JSON.stringify(formData),
    contentType: 'application/json',
    success: function(response) {
        alert('Item added successfully');
        getInventoryItems(); // Fetch the updated list
    },
    error: function(jqXHR, textStatus, errorThrown) {
        console.error(jqXHR, textStatus, errorThrown);
        alert('Failed to add item');
    }
});
});
function getInventoryItems() {
    $.ajax({
        url: '../../rest/inventory',
        method: 'GET',
        success: function(data) {
            console.log("Data received from server:", data);  
            const inventoryTableBody = document.querySelector("#inventoryTable tbody");
            inventoryTableBody.innerHTML = ''; 

            data.forEach(item => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${item.itemName}</td>
                    <td>${item.unitPrice}</td>
                    <td>${item.quantity}</td>
                    <td>${item.supplierName}</td>
                    <td>${item.categoryName}</td>
                    <td>${item.voltageRating || 'N/A'}</td>
                    <td>${item.amperageRating || 'N/A'}</td>
                      <td>${item.description}</td>
                    <td>
                        <button onclick="editItem(${item.itemID})">Edit</button>
                        <button onclick="deleteItem(${item.itemID})">Delete</button>
                    </td>
                `;
                $('#inventoryTable tbody').html(output);
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error("Error fetching inventory items:", textStatus, errorThrown);
        }
    });
}
getInventoryItems();
function formatPrice(input) {
    let value = parseFloat(input.value.replace(',', '.')) || 0;
    input.value = value.toFixed(2); 
}
    </script>
 </body>
</html>