<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <link rel="stylesheet" href="./../assets/css/styles.css">
    
</head>
<body>
    <div class="sidebar">
        <div class="profile">
            <img src="/frontend/assets/pictures/asv_logo.png" alt="Company logo">
            <h2>Naida Sma</h2>
            <p>Admin</p>
        </div>
        <ul class="nav-links">
            <li><a href="main_page.html">Dashboard</a></li>
            <li><a href="inventory_management.html">Inventory Management</a></li>
            <li><a href="categories.html">Categories</a></li>
            <li><a href="suppliers.html">Suppliers</a></li>
            <li><a href="invoice.html">Invoice</a></li>
            <li><a href="setting.html">Settings</a></li>
            <li><a href="barcode.html">Barcode scanning</a></li>

        </ul>
    </div>
        <div class="inventory-management">
            <header>
                <h1>Inventory Management</h1>
            </header>
            <div class="inventory-content">
                <div class="form-container">
                    <form id="inventoryForm">
                        <h2>Add New Item</h2>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="itemName">Item Name</label>
                                <input type="text" id="itemName" name="itemName" required>
                            </div>
        
                            
                        </div>
        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="unitPrice">Unit Price</label>
                                <input type="number" id="unitPrice" name="unitPrice" step="0.01" required>
                            </div>
        
                            <div class="form-group">
                                <label for="quantity">Quantity</label>
                                <input type="number" id="quantity" name="quantity" required>
                            </div>
                        </div>
                           
        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="supplierID">Supplier</label>
                                <select id="supplierID" name="supplierID" >
                                    <option value="" disabled selected>Select Supplier</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
        
                            <div class="form-group">
                                <label for="categoryID">Category</label>
                                <select id="categoryID" name="categoryID" onchange="getCategories(this.value)" >
                                    <option value="" disabled selected>Select Category</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                        </div>
        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="warehouseID">Warehouse</label>
                                <select id="warehouseID" name="warehouseID">
                                    <option value="" disabled selected>Select Warehouse</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
        
                            <div class="form-group">
                                <label for="userID">User</label>
                                <select id="userID" name="userID">
                                    <option value="" disabled selected>Select User</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                        </div>
        
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" required></textarea>
                        </div>
        
                        <div class="form-group">
                            <button type="submit">Add Item</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>        
        <div class="list-container">
            <h2>Inventory List</h2>
        <table id="inventoryTable">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Description</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Voltage Rating</th>
                    <th>Amperage Rating</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Inventory items will be appended here dynamically -->
            </tbody>
        </table>
    </div>
    </div>
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/jquery.min.js"></script>

    <script >
$(document).ready(function() {
    // Submit form data to the server
    $('#inventoryForm').on('submit', function(e) {
        e.preventDefault(); 

        const formData = {
            itemName: $('#itemName').val(),
            unitPrice: $('#unitPrice').val(),
            quantity: $('#quantity').val(),
            supplierID: $('#supplierID').val(),
            categoryID: $('#categoryID').val(),
            warehouseID: $('#warehouseID').val(),
            userID: $('#userID').val(),
            description: $('#description').val()
        };

        $.ajax({
            url: '../../rest/inventory/add',
            method: 'POST',
            data: formData,
            success: function(response) {
                console.log("Item added successfully:", response);
                getInventoryList(); 
                $('#inventoryForm')[0].reset(); 
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Error adding item:", textStatus, errorThrown);
            }
        });
    });

    function getInventoryList() {
        $.ajax({
            url: '../../rest/inventory', 
            method: 'GET',
            success: function(data) {
                let output = '';
                data.forEach(item => {
                    output += `
                        <tr>
                            <td>${item.itemName}</td>
                            <td>${item.description}</td>
                            <td>${item.quantity}</td>
                            <td>${item.unitPrice}</td>
                            <td>${item.voltageRating}</td>
                            <td>${item.amperageRating}</td>
                            <td>
                                <button class="update-btn" data-id="${item.itemID}">Update</button>
                                <button class="delete-btn" data-id="${item.itemID}">Delete</button>
                            </td>
                        </tr>`;
                });
                $('#inventoryTable tbody').html(output);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Error fetching inventory:", textStatus, errorThrown);
            }
        });
    }

    
    getInventoryList();
});

function deleteItem (id) {
    $.ajax({
        url: '../../rest/inventory/' + id,
        method: 'DELETE',
        success: function() {
            console.log("Item deleted successfully.");
            getAllItems(); 
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log(jqXHR);
            console.log(textStatus);
            console.log(errorThrown);
        }
    });
}

function getCategories(id) {
    $.ajax({
      url: '../../rest/categories/' + id,
      method: 'GET',
      success: function(data) {

        output = '';

        data.forEach(meal => {
          output += '<option value="" selected>'+category.categoryName + '</option>';
        })

        const categoryID = document.getElementById('categoryID');
        categoryID.innerHTML = output;  
        
      },
      error: function(jqXHR, textStatus, errorThrown) {
          console.log(jqXHR);
          console.log(textStatus);
          console.log(errorThrown);
          $("#portofioItems").html("<p>There was an error loading the data. Please try again later.</p>");
      }
    }) 

  }

    </script>
 </body>
</html>